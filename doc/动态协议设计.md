动态协议设计  
======  
# 动态协议需求  
针对MCU测控应用场景，软硬件往往是通用的，而不是针对某一项目定制的。例如，PLC、canopen的测控模块等。这些设备的组合形成不同的测控系统  
> - 对于一个系统，可能由多种配置方法，可以使用不同的设备实现同一参数的测控。这样就造成同一个参数有多种协议传输  
> - 配置变更后，系统的二进制历史数据就只有老的程序才能打开，经过多次变更、软件升级后，历史数据基本无法使用了  
针对此需求，可使用动态协议配置的方式满足。  
1. 动态协议配置是将测控所需的参数放在“参数数据库”中（例如canopen的对象字典，modbus的寄存器），测控逻辑在数据库中操作，协议对数据库进行读写，实现逻辑与协议分离。  
2. 通过协议的动态配置，实现不修改代码，仅修改配置就适配不同的协议。  
![image](draft/动态协议框架.png)  
# 动态协议概念设计  
## 参数  
参数是协议中承载的变量，可被，类型包括：  
1. 数值：例如整数、浮点数  
2. 数组：例如字符串、二进制序列  
特殊的，当参数用于显示时，可以分为几类：  
1. 数组型，按字符串显示  
1. 数组型，未知格式，按hex显示  
1. 数值型，按配置的小数位数显示  
1. 数值型，按枚举字符串显示  
参数对于逻辑程序来说，可以使用指针访问，因为逻辑程序一定知道参数的类型。总结来说，可以按以上4类作为参数类的子类设计  
## 协议  
协议包括3部分：数据的帧同步、数据帧中各域的拆分、数据域树形结构的叶子节点处理  
### 数据帧同步  
数据可通过同步头+校验的方式从数据流中确定一个数据帧的范围，例如二进制协议中通过包头、校验和的方式进行传输  
数据可通过帧尾同步的方式提取数据，例如文本行协议中，通过分行符和分列符实现数据分割。  
### 数据域拆分  
数据域的组织可以分为几种：loop、switch、